generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mongodb"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  username  String   @unique
  firstName String
  lastName  String
  password  String
  roleId    String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrdersAuditTrail {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  username   String
  userId     String
  action     String
  actionTime DateTime @default(now())
  orderId    String
  storeId    String
}

model MilkRunAuditTrail {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  username     String
  userId       String
  action       String
  actionTime   DateTime @default(now())
  orderId      String
  storeId      String
  agentId      String
  agentName    String
  deliveryDate String
}

model Category {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  categoryId   Int      @unique // ID Magento
  nameCategory String
}

model Warehouse {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  warehouseId Int      @unique // ID Magento
  websiteId   Int
  name        String
  code        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  purchaseOrders PurchaseOrder[] 
}
model products {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  product_id     Int      @unique // ID Magento
  sku            String   @unique
  name           String
  price          Float
  special_price  Float?
  cost           Float?
  manufacturer   String?  // ID du fabricant
  category_ids   String[]   @db.String// IDs Magento des catégories
  website_ids    Int[]    @db.Int// IDs Magento des entrepôts
  image          String?
  url_key        String?
  created_at     String  @map("created_at")
  updated_at     String
  stock_item     StockItem?

  @@index([category_ids])
}
model StockItem {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  item_id        Int?
  product_id     Int    @unique
  stock_id       Int?
  qty            Float?
  is_in_stock    Boolean?
  min_qty        Float?
  min_sale_qty   Float?
  max_sale_qty   Float?
  backorders     Int?
  low_stock_date String?
  product        products @relation(fields: [product_id], references: [product_id])
}



model Manufacturer {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  manufacturerId       Int      @unique // Correspond à manufacturer_id dans le JSON
  code                 String   @unique
  companyName          String   @map("company_name")
  contactName          String?  @map("contact_name")
  phoneNumber          String?  @map("phone_number")
  postalCode           String?  @map("postal_code")
  city                 String?
  country              String?
  capital              String?
  email                String?
  payments             Payment[]     
  purchaseOrders       PurchaseOrder[] 
  address              String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("manufacturers")
}
model Payment {

  id             String         @id @default(auto()) @map("_id") @db.ObjectId

  amount         Float

  paymentMethod  PaymentMethod
  percentage     Float
  paymentDate    DateTime?

  manufacturer   Manufacturer   @relation(fields: [manufacturerId], references: [manufacturerId])

  manufacturerId Int

  purchaseOrder  PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])

  purchaseOrderId String?        @db.ObjectId

  createdAt      DateTime       @default(now())

  updatedAt      DateTime       @updatedAt

  @@map("payments")

}

enum PaymentMethod {
  CHEQUE
  TRAITE
  ESPECES
}


enum OrderState {

  IN_PROGRESS

  READY

  DELIVERED

  COMPLETED


}
model File {

  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String 
  url       String
  order     PurchaseOrder? @relation(fields: [orderId], references: [id])

  orderId   String?        @db.ObjectId

  @@map("files")

}
model Comment {

  id              String         @id @default(auto()) @map("_id") @db.ObjectId

  content         String

  purchaseOrder   PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id])

  purchaseOrderId String         @db.ObjectId

}

model PurchaseOrder {

  id              String         @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber     String         @unique
  manufacturer    Manufacturer   @relation(fields: [manufacturerId], references: [manufacturerId])
  manufacturerId  Int
  warehouse       Warehouse      @relation(fields: [warehouseId], references: [warehouseId])
  warehouseId     Int
  deliveryDate    DateTime
  totalAmount     Float
  status          OrderState
  comments        Comment[]
  payments        Payment[]
  files           File[]
  products        ProductOrdered[] 
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  @@map("purchase_orders")

}

model ProductOrdered {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  quantity       Int
  priceExclTax   Float
  total          Float 
  sku            String?
  purchaseOrder  PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])
  purchaseOrderId String?
  @@map("productOrdered")
}

